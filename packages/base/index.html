<!DOCTYPE html>
<html>
<head>
  <title>Micro-Frontend demo</title>
  <script type="module">
    import { registerLazyComponents } from "./public/lazy.js";

    let assets = await fetch("/public/assets.json").then(r => r.json());
    if (localStorage.getItem("dev")) {
      try {
        assets = await fetch("http://localhost:1234/dev", {
          method: "POST",
          body: JSON.stringify(assets),
          headers: { "content-type": "application/json" }
        }).then(r => r.json());
      } catch {
        console.warn("Helper server not started");
      }
    }
    registerLazyComponents(Object.values(assets).filter(a => a.component).reduce((acc, cur) => ({
      ...acc,
      [cur.component]: cur.target
    }), {}), false);
    Object.values(assets).filter(a => a.load).forEach(a => import(a.target));
  </script>
</head>

<body is="ex-body">

</body>

</html>