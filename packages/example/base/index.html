<!DOCTYPE html>
<html lang="en">
<head>
    <title>Micro-Frontend demo</title>
    <script type="module">
    </script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        body{
            background-color: #1e1e20;
            color: white;
            font-family: "Avenir Next", "Tahoma";
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
    </style>
    <script type="module">
        (async ()=>{
            const apps = {
                purple: "/purple.js",
                red: "/red.js",
                green: "/green.js",
                turquoise: "/turquoise.js",
                blue: "/blue.js",
            }
            for (const x of Array(Object.keys(apps).length).keys()) {
                const pkg = await fetch(`http://localhost:${5173 + x}/package.json`).then(r => r.json()).catch(() => undefined)
                if (pkg?.name)
                    apps[pkg.name] = `http://localhost:${5173 + x}/${pkg.main || 'src/main.ts'}`
            }
            for (const url of Object.values(apps)) import(/* @vite-ignore */url)
        })()
    </script>
</head>

<body x-data="{ counter: 1 }">
<template x-for="app in ['blue', 'green', 'purple', 'red', 'turquoise']">
    <div x-data="{show: localStorage[app]==='true'}" style="display: flex; align-items: center; flex-direction: column">
        <h3 x-text="`${show?'[':''}${app.toUpperCase()}${show?']':''}`" @click="show=!show; localStorage[app]=show"></h3>
        <template x-if="show">
            <div x-html="`<ex-${app} x-bind:my-count='counter' @my-event='console.log($event); counter++'></ex-${app}>`"></div>
        </template>
    </div>
</template>
</body>
</html>
