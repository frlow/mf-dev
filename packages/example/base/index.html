<!DOCTYPE html>
<html lang="en">
<head>
    <title>Micro-Frontend demo</title>
    <script type="module">
    </script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/pinecone-router@3.x.x/dist/router.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <script type="module">
        (async ()=>{
            const apps = {
                purple: "/purple.js",
                red: "/red.js",
                green: "/green.js",
                turquoise: "/turquoise.js",
                blue: "/blue.js",
            }
            const dev = localStorage.dev ? parseInt(localStorage.dev) : 0
            for (const x of Array(dev).keys()) {
                const pkg = await fetch(`http://localhost:${5173 + x}/package.json`).then(r => r.json()).catch(() => undefined)
                if (pkg?.name)
                    apps[pkg.name] = `http://localhost:${5173 + x}/${pkg.main || 'src/main.ts'}`
            }
            for (const url of Object.values(apps)) import(url)
        })()
    </script>
</head>

<body x-data="{ counter: 1 }">
<template x-for="app in ['blue', 'green', 'purple', 'red', 'turquoise']">
    <div x-data="{show: localStorage[app]==='true'}">
        <h3 x-text="`${show?'[':''}${app.toUpperCase()}${show?']':''}`" @click="show=!show; localStorage[app]=show"></h3>
        <template x-if="show">
            <div x-html="`<ex-${app}></ex-${app}>`"></div>
        </template>
    </div>
</template>
</body>
</html>
